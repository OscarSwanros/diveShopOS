<% content_for(:page_title, t("settings.domain.title")) %>

<div class="space-y-6">
  <h1 class="text-2xl font-bold text-gray-900"><%= t("settings.domain.title") %></h1>

  <%# Card 1: Your Subdomain (read-only) %>
  <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
    <h2 class="text-xl font-semibold text-gray-900"><%= t("settings.domain.subdomain.title") %></h2>
    <p class="mt-1 text-sm text-gray-500"><%= t("settings.domain.subdomain.description") %></p>

    <div class="mt-4">
      <span class="inline-flex items-center px-3 py-2 rounded-md bg-gray-100 text-sm font-mono text-gray-800">
        <%= t("settings.domain.subdomain.url", subdomain: @organization.subdomain, platform_domain: @platform_domain) %>
      </span>
    </div>
  </div>

  <%# Card 2: Custom Domain %>
  <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
    <h2 class="text-xl font-semibold text-gray-900"><%= t("settings.domain.custom_domain.title") %></h2>

    <%= form_with model: @organization, url: settings_domain_path, method: :patch, class: "mt-4 space-y-4" do |f| %>
      <div>
        <% if @organization.errors[:custom_domain].any? %>
          <div class="mb-2 text-sm text-red-600" role="alert">
            <%= @organization.errors.full_messages_for(:custom_domain).join(", ") %>
          </div>
        <% end %>

        <%= f.label :custom_domain, t("settings.domain.custom_domain.label"),
              class: "block text-sm font-medium text-gray-700" %>
        <%= f.text_field :custom_domain,
              placeholder: t("settings.domain.custom_domain.placeholder"),
              class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm",
              aria: { describedby: "custom_domain_help" } %>
        <p class="mt-1 text-sm text-gray-500" id="custom_domain_help">
          <%= t("settings.domain.custom_domain.help") %>
        </p>
      </div>

      <div class="flex items-center space-x-3">
        <%= f.submit t("common.save"),
              class: "inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" %>

        <% if @organization.custom_domain.present? %>
          <%= button_to t("settings.domain.verify.action"), verify_settings_domain_path,
                method: :post,
                class: "inline-flex items-center px-4 py-2 bg-white text-gray-700 text-sm font-medium rounded-md border border-gray-300 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" %>
        <% end %>
      </div>
    <% end %>

    <div class="mt-4" id="dns_verification_result">
      <%= render "settings/domains/verification_result", result: nil %>
    </div>
  </div>

  <%# Card 3: DNS Configuration Instructions %>
  <% if @organization.custom_domain.present? %>
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
      <h2 class="text-xl font-semibold text-gray-900"><%= t("settings.domain.dns.title") %></h2>
      <p class="mt-1 text-sm text-gray-500"><%= t("settings.domain.dns.instructions") %></p>

      <div class="mt-4 overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"><%= t("settings.domain.dns.type") %></th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"><%= t("settings.domain.dns.name") %></th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"><%= t("settings.domain.dns.target") %></th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            <tr>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-900">CNAME</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-900"><%= @organization.custom_domain %></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-900"><%= @organization.subdomain %>.<%= @platform_domain %></td>
            </tr>
          </tbody>
        </table>
      </div>

      <p class="mt-4 text-sm text-gray-500"><%= t("settings.domain.dns.propagation_note") %></p>
    </div>
  <% end %>
</div>
