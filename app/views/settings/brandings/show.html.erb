<% content_for(:page_title, t("settings.branding.title")) %>

<div class="space-y-6" data-controller="branding-preview">
  <h1 class="text-2xl font-bold text-gray-900"><%= t("settings.branding.title") %></h1>

  <%= form_with model: @organization, url: settings_branding_path, method: :patch, class: "space-y-6" do |f| %>

    <%# Card 1: Logo & Favicon %>
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 space-y-4">
      <h2 class="text-xl font-semibold text-gray-900"><%= t("settings.branding.logo") %> & <%= t("settings.branding.favicon") %></h2>

      <div class="grid gap-6 sm:grid-cols-2">
        <div>
          <%= f.label :logo, t("settings.branding.logo"), class: "block text-sm font-medium text-gray-700" %>
          <% if @organization.logo.attached? %>
            <div class="mt-2 mb-3">
              <%= image_tag @organization.logo, alt: t("settings.branding.logo"), class: "h-12 w-auto" %>
            </div>
          <% end %>
          <%= f.file_field :logo, accept: "image/png,image/jpeg,image/svg+xml",
                class: "mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100" %>
          <p class="mt-1 text-sm text-gray-500"><%= t("settings.branding.logo_help") %></p>
        </div>

        <div>
          <%= f.label :favicon, t("settings.branding.favicon"), class: "block text-sm font-medium text-gray-700" %>
          <% if @organization.favicon.attached? %>
            <div class="mt-2 mb-3">
              <%= image_tag @organization.favicon, alt: t("settings.branding.favicon"), class: "h-8 w-auto" %>
            </div>
          <% end %>
          <%= f.file_field :favicon, accept: "image/png,image/x-icon,image/svg+xml",
                class: "mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100" %>
          <p class="mt-1 text-sm text-gray-500"><%= t("settings.branding.favicon_help") %></p>
        </div>
      </div>
    </div>

    <%# Card 2: Colors %>
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 space-y-4">
      <h2 class="text-xl font-semibold text-gray-900"><%= t("settings.branding.colors") %></h2>

      <div class="grid gap-6 sm:grid-cols-2">
        <div>
          <%= f.label :brand_primary_color, t("settings.branding.primary_color"), class: "block text-sm font-medium text-gray-700" %>
          <div class="mt-1 flex items-center space-x-3">
            <%= f.color_field :brand_primary_color, value: @organization.brand_primary_color || "#2563eb",
                  class: "h-10 w-14 rounded-md border border-gray-300 cursor-pointer",
                  data: { branding_preview_target: "primaryColor", action: "input->branding-preview#updatePreview" } %>
            <%= f.text_field :brand_primary_color, value: @organization.brand_primary_color,
                  placeholder: "#2563eb",
                  class: "block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm font-mono",
                  data: { branding_preview_target: "primaryHex", action: "input->branding-preview#updateFromHex" } %>
          </div>
          <% if @organization.errors[:brand_primary_color].any? %>
            <p class="mt-1 text-sm text-red-600"><%= @organization.errors.full_messages_for(:brand_primary_color).join(", ") %></p>
          <% end %>
        </div>

        <div>
          <%= f.label :brand_accent_color, t("settings.branding.accent_color"), class: "block text-sm font-medium text-gray-700" %>
          <div class="mt-1 flex items-center space-x-3">
            <%= f.color_field :brand_accent_color, value: @organization.brand_accent_color || "#059669",
                  class: "h-10 w-14 rounded-md border border-gray-300 cursor-pointer",
                  data: { branding_preview_target: "accentColor", action: "input->branding-preview#updatePreview" } %>
            <%= f.text_field :brand_accent_color, value: @organization.brand_accent_color,
                  placeholder: "#059669",
                  class: "block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm font-mono",
                  data: { branding_preview_target: "accentHex", action: "input->branding-preview#updateFromHex" } %>
          </div>
          <% if @organization.errors[:brand_accent_color].any? %>
            <p class="mt-1 text-sm text-red-600"><%= @organization.errors.full_messages_for(:brand_accent_color).join(", ") %></p>
          <% end %>
        </div>
      </div>

      <%# Live preview %>
      <div class="mt-4 p-4 bg-gray-50 rounded-md">
        <p class="text-sm font-medium text-gray-700 mb-3"><%= t("settings.branding.color_preview") %></p>
        <div class="flex items-center space-x-3">
          <button type="button" data-branding-preview-target="previewButton"
                  class="inline-flex items-center px-4 py-2 text-white text-sm font-medium rounded-md"
                  style="background-color: <%= @organization.brand_primary_color || '#2563eb' %>;">
            <%= t("settings.branding.sample_button") %>
          </button>
          <span data-branding-preview-target="previewLink"
                class="text-sm font-medium cursor-default"
                style="color: <%= @organization.brand_primary_color || '#2563eb' %>;">
            <%= t("settings.branding.sample_link") %>
          </span>
        </div>
        <p class="mt-2 text-sm text-amber-600 hidden" data-branding-preview-target="contrastWarning">
          <%= t("settings.branding.accessibility_warning") %>
        </p>
      </div>
    </div>

    <%# Card 3: Shop Info %>
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 space-y-4">
      <h2 class="text-xl font-semibold text-gray-900"><%= t("settings.branding.shop_info") %></h2>

      <div>
        <%= f.label :tagline, t("settings.branding.tagline"), class: "block text-sm font-medium text-gray-700" %>
        <%= f.text_field :tagline,
              class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm",
              placeholder: t("settings.branding.tagline_placeholder") %>
      </div>

      <div class="grid gap-4 sm:grid-cols-2">
        <div>
          <%= f.label :phone, t("settings.branding.phone"), class: "block text-sm font-medium text-gray-700" %>
          <%= f.phone_field :phone,
                class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm" %>
        </div>
        <div>
          <%= f.label :contact_email, t("settings.branding.contact_email"), class: "block text-sm font-medium text-gray-700" %>
          <%= f.email_field :contact_email,
                class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm" %>
          <% if @organization.errors[:contact_email].any? %>
            <p class="mt-1 text-sm text-red-600"><%= @organization.errors.full_messages_for(:contact_email).join(", ") %></p>
          <% end %>
        </div>
      </div>

      <div>
        <%= f.label :address, t("settings.branding.address"), class: "block text-sm font-medium text-gray-700" %>
        <%= f.text_area :address, rows: 2,
              class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm" %>
      </div>
    </div>

    <%# Card 4: Social Links %>
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 space-y-4">
      <h2 class="text-xl font-semibold text-gray-900"><%= t("settings.branding.social_links") %></h2>

      <%= f.fields_for :social_links do |sl| %>
        <div class="space-y-4">
          <div>
            <%= sl.label :facebook, "Facebook", class: "block text-sm font-medium text-gray-700" %>
            <%= sl.url_field :facebook, value: @organization.social_links&.dig("facebook"),
                  placeholder: "https://facebook.com/yourdiveshop",
                  class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm" %>
          </div>
          <div>
            <%= sl.label :instagram, "Instagram", class: "block text-sm font-medium text-gray-700" %>
            <%= sl.url_field :instagram, value: @organization.social_links&.dig("instagram"),
                  placeholder: "https://instagram.com/yourdiveshop",
                  class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm" %>
          </div>
          <div>
            <%= sl.label :youtube, "YouTube", class: "block text-sm font-medium text-gray-700" %>
            <%= sl.url_field :youtube, value: @organization.social_links&.dig("youtube"),
                  placeholder: "https://youtube.com/@yourdiveshop",
                  class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm" %>
          </div>
        </div>
      <% end %>
    </div>

    <%# Save button %>
    <div class="flex items-center space-x-3">
      <%= f.submit t("common.save"),
            class: "inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" %>
    </div>
  <% end %>
</div>
