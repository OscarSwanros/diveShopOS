<div class="space-y-6">
  <div class="flex items-center justify-between">
    <h1 class="text-2xl font-bold"><%= t("equipment_items.index.title") %></h1>
    <% if policy(EquipmentItem).create? %>
      <%= link_to t("equipment_items.index.new"), new_equipment_item_path,
        class: "inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" %>
    <% end %>
  </div>

  <%= render "shared/filter_bar", filters: [
    { label: t("excursions.filters.all"), url: equipment_items_path, active: @safety_filter.blank? && params[:category].blank? },
    { label: t("equipment_items.filters.service_overdue", default: "Service Overdue"), url: equipment_items_path(safety: "service_overdue"), active: @safety_filter == "service_overdue" }
  ], semantic: @safety_filter == "service_overdue" ? :danger : :default %>

  <% if @safety_filter == "service_overdue" %>
    <div class="bg-red-50 border border-red-200 rounded-md p-3" role="alert">
      <p class="text-sm text-red-800"><%= t("equipment_items.filters.service_overdue_banner", default: "Showing life-support equipment overdue for service. These items must not be assigned until serviced.") %></p>
    </div>
  <% else %>
    <div class="flex flex-wrap gap-2">
      <%= link_to t("excursions.filters.all"), equipment_items_path,
        class: "px-3 py-1 text-sm rounded-md #{params[:category].blank? ? 'bg-blue-100 text-blue-800 font-medium' : 'text-gray-600 hover:bg-gray-100'}" %>
      <% EquipmentItem.categories.each_key do |cat| %>
        <%= link_to t("equipment_items.categories.#{cat}"), equipment_items_path(category: cat, status: params[:status]),
          class: "px-3 py-1 text-sm rounded-md #{params[:category] == cat ? 'bg-blue-100 text-blue-800 font-medium' : 'text-gray-600 hover:bg-gray-100'}" %>
      <% end %>
    </div>

    <div class="flex flex-wrap gap-2">
      <% EquipmentItem.statuses.each_key do |st| %>
        <%= link_to t("equipment_items.statuses.#{st}"), equipment_items_path(category: params[:category], status: st),
          class: "px-3 py-1 text-sm rounded-md #{params[:status] == st ? 'bg-blue-100 text-blue-800 font-medium' : 'text-gray-600 hover:bg-gray-100'}" %>
      <% end %>
    </div>
  <% end %>

  <% if @equipment_items.any? %>
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"><%= t("equipment_items.table.name") %></th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"><%= t("equipment_items.table.category") %></th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"><%= t("equipment_items.table.size") %></th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"><%= t("equipment_items.table.status") %></th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"><%= t("equipment_items.table.service") %></th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <% @equipment_items.each do |item| %>
            <tr>
              <td class="px-6 py-4 whitespace-nowrap text-sm">
                <%= link_to item.name, item, class: "text-blue-600 hover:text-blue-800 font-medium" %>
                <% if item.life_support? %>
                  <span class="ml-1 inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium bg-purple-100 text-purple-800"><%= t("equipment_items.life_support_badge") %></span>
                <% end %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= t("equipment_items.categories.#{item.category}") %></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= item.size || "---" %></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm">
                <% badge_class = case item.status
                  when "available" then "bg-green-100 text-green-800"
                  when "assigned" then "bg-blue-100 text-blue-800"
                  when "in_service" then "bg-amber-100 text-amber-800"
                  when "retired" then "bg-gray-100 text-gray-800"
                  end %>
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium <%= badge_class %>">
                  <%= t("equipment_items.statuses.#{item.status}") %>
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm">
                <% if item.life_support? %>
                  <% if item.service_current? %>
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"><%= t("equipment_items.service_status.current") %></span>
                  <% else %>
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800"><%= t("equipment_items.service_status.overdue") %></span>
                  <% end %>
                <% else %>
                  <span class="text-gray-400">---</span>
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% else %>
    <%= render "shared/empty_state",
      icon: :equipment,
      title: t("empty_states.equipment.title"),
      description: t("empty_states.equipment.description"),
      action_text: policy(EquipmentItem).create? ? t("equipment_items.index.new") : nil,
      action_path: policy(EquipmentItem).create? ? new_equipment_item_path : nil %>
  <% end %>
</div>
