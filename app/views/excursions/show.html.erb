<div class="space-y-6">
  <div class="flex items-center justify-between">
    <div>
      <h1 class="text-2xl font-bold"><%= @excursion.title %></h1>
      <p class="text-sm text-gray-500 mt-1">
        <%= l(@excursion.scheduled_date, format: :long) %>
        <% if @excursion.departure_time %>
          &middot; <%= t("excursions.show.departs") %> <%= @excursion.departure_time.strftime("%H:%M") %>
        <% end %>
        <% if @excursion.return_time %>
          &middot; <%= t("excursions.show.returns") %> <%= @excursion.return_time.strftime("%H:%M") %>
        <% end %>
      </p>
    </div>
    <div class="space-x-2">
      <% if policy(@excursion).update? %>
        <%= link_to t("common.edit"), edit_excursion_path(@excursion),
          class: "inline-flex items-center px-4 py-2 bg-white text-gray-700 text-sm font-medium rounded-md border border-gray-300 hover:bg-gray-50" %>
      <% end %>
      <%= link_to t("common.back"), excursions_path,
        class: "inline-flex items-center px-4 py-2 bg-white text-gray-700 text-sm font-medium rounded-md border border-gray-300 hover:bg-gray-50" %>
    </div>
  </div>

  <%# Excursion details card %>
  <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
    <dl class="grid grid-cols-1 gap-4 sm:grid-cols-3">
      <div>
        <dt class="text-sm font-medium text-gray-500"><%= t("excursions.show.status") %></dt>
        <dd class="mt-1">
          <% badge_class = case @excursion.status
            when "draft" then "bg-gray-100 text-gray-800"
            when "published" then "bg-green-100 text-green-800"
            when "cancelled" then "bg-red-100 text-red-800"
            when "completed" then "bg-blue-100 text-blue-800"
            end %>
          <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium <%= badge_class %>">
            <%= t("excursions.statuses.#{@excursion.status}") %>
          </span>
        </dd>
      </div>
      <div>
        <dt class="text-sm font-medium text-gray-500"><%= t("excursions.show.capacity") %></dt>
        <dd class="mt-1 text-sm text-gray-900"><%= @excursion.trip_participants.count %> / <%= @excursion.capacity %></dd>
      </div>
      <div>
        <dt class="text-sm font-medium text-gray-500"><%= t("excursions.show.price") %></dt>
        <dd class="mt-1 text-sm text-gray-900">
          <%= number_to_currency(@excursion.price, unit: @excursion.price_currency == "USD" ? "$" : @excursion.price_currency) %>
        </dd>
      </div>
    </dl>
    <% if @excursion.description.present? %>
      <div class="mt-4 pt-4 border-t border-gray-200">
        <dt class="text-sm font-medium text-gray-500"><%= t("excursions.show.description") %></dt>
        <dd class="mt-1 text-sm text-gray-900"><%= @excursion.description %></dd>
      </div>
    <% end %>
    <% if @excursion.notes.present? %>
      <div class="mt-4 pt-4 border-t border-gray-200">
        <dt class="text-sm font-medium text-gray-500"><%= t("excursions.show.staff_notes") %></dt>
        <dd class="mt-1 text-sm text-gray-900"><%= @excursion.notes %></dd>
      </div>
    <% end %>
  </div>

  <%# Trip Dives section %>
  <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-xl font-semibold"><%= t("excursions.show.dives") %></h2>
      <% if policy(TripDive).create? %>
        <%= link_to t("trip_dives.new.title"), new_excursion_trip_dive_path(@excursion),
          class: "inline-flex items-center px-3 py-1.5 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" %>
      <% end %>
    </div>

    <% if @trip_dives.any? %>
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">#</th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"><%= t("trip_dives.table.site") %></th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"><%= t("trip_dives.table.max_depth") %></th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"><%= t("trip_dives.table.bottom_time") %></th>
              <th class="px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase"><%= t("common.actions") %></th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            <% @trip_dives.each do |dive| %>
              <tr>
                <td class="px-4 py-2 text-sm text-gray-900"><%= dive.dive_number %></td>
                <td class="px-4 py-2 text-sm text-gray-900"><%= dive.dive_site.name %></td>
                <td class="px-4 py-2 text-sm text-gray-900"><%= dive.planned_max_depth_meters ? "#{dive.planned_max_depth_meters}m" : "---" %></td>
                <td class="px-4 py-2 text-sm text-gray-900"><%= dive.planned_bottom_time_minutes ? "#{dive.planned_bottom_time_minutes} min" : "---" %></td>
                <td class="px-4 py-2 text-sm text-right space-x-2">
                  <%= link_to t("common.edit"), edit_excursion_trip_dive_path(@excursion, dive), class: "text-blue-600 hover:text-blue-800" %>
                  <%= button_to t("common.delete"), excursion_trip_dive_path(@excursion, dive), method: :delete,
                    class: "text-red-600 hover:text-red-800",
                    form: { data: { turbo_confirm: t("common.confirm_delete") } } %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    <% else %>
      <p class="text-sm text-gray-500"><%= t("trip_dives.empty") %></p>
    <% end %>
  </div>

  <%# Trip Manifest (Participants) section %>
  <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-xl font-semibold"><%= t("excursions.show.manifest") %></h2>
      <% if policy(TripParticipant).create? %>
        <%= link_to t("trip_participants.new.title"), new_excursion_trip_participant_path(@excursion),
          class: "inline-flex items-center px-3 py-1.5 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" %>
      <% end %>
    </div>

    <% if @trip_participants.any? %>
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"><%= t("trip_participants.table.name") %></th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"><%= t("trip_participants.table.role") %></th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"><%= t("trip_participants.table.certification") %></th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"><%= t("trip_participants.table.paid") %></th>
              <th class="px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase"><%= t("common.actions") %></th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            <% @trip_participants.each do |participant| %>
              <tr>
                <td class="px-4 py-2 text-sm text-gray-900">
                  <%= participant.name %>
                  <% if participant.email.present? %>
                    <span class="block text-xs text-gray-500"><%= participant.email %></span>
                  <% end %>
                </td>
                <td class="px-4 py-2 text-sm text-gray-900"><%= t("trip_participants.roles.#{participant.role}") %></td>
                <td class="px-4 py-2 text-sm text-gray-900">
                  <% if participant.certification_level.present? %>
                    <%= participant.certification_level %>
                    <% if participant.certification_agency.present? %>
                      <span class="text-xs text-gray-500">(<%= participant.certification_agency %>)</span>
                    <% end %>
                  <% else %>
                    <span class="text-gray-400">---</span>
                  <% end %>
                </td>
                <td class="px-4 py-2 text-sm">
                  <% if participant.paid? %>
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"><%= t("trip_participants.paid_status.paid") %></span>
                  <% else %>
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-amber-100 text-amber-800"><%= t("trip_participants.paid_status.unpaid") %></span>
                  <% end %>
                </td>
                <td class="px-4 py-2 text-sm text-right space-x-2">
                  <%= link_to t("common.edit"), edit_excursion_trip_participant_path(@excursion, participant), class: "text-blue-600 hover:text-blue-800" %>
                  <%= button_to t("common.delete"), excursion_trip_participant_path(@excursion, participant), method: :delete,
                    class: "text-red-600 hover:text-red-800",
                    form: { data: { turbo_confirm: t("common.confirm_delete") } } %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    <% else %>
      <p class="text-sm text-gray-500"><%= t("trip_participants.empty") %></p>
    <% end %>
  </div>
</div>
